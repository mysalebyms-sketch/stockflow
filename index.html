<!DOCTYPE html>
<html lang="th">
<head>
  <!-- =================================================
       META / CONFIG
  ================================================== -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Stock Viewer v2</title>

  <!-- =================================================
       DESIGN TOKENS (LOCKED)
  ================================================== -->
  <style id="tokens">
    :root {
      /* colors */
      --primary: #2563EB;
      --success: #16A34A;
      --warning: #F59E0B;
      --danger:  #DC2626;

      --gray-900: #111827;
      --gray-600: #4B5563;
      --gray-400: #9CA3AF;
      --gray-200: #E5E7EB;
      --gray-100: #F3F4F6;
      --white: #FFFFFF;

      /* radius */
      --r-sm: 8px;
      --r-md: 12px;
      --r-lg: 16px;

      /* shadow */
      --shadow-card: 0 6px 18px rgba(0,0,0,.08);
      --shadow-float: 0 10px 32px rgba(0,0,0,.12);
    }
  </style>

  <!-- =================================================
       BASE / RESET
  ================================================== -->
  <style id="base-style">
    /* reset + body + typography */
  </style>

  <!-- =================================================
       COMPONENT STYLES
  ================================================== -->
  <style id="components-style">
    /* card / button / badge / sheet / input */
  </style>

  <!-- =================================================
       VIEWER v2 STYLES
  ================================================== -->
  <style id="viewer-style">
    /* screen-specific layout */
  </style>
</head>

<body>

  <!-- =================================================
       APP ROOT
  ================================================== -->
  <header id="app-header"></header>
  <main id="app"></main>

  <!-- global backdrop -->
  <div id="backdrop"></div>

  <!-- sheets -->
  <div id="product-sheet" class="sheet"></div>
  <div id="qty-sheet" class="sheet"></div>
  <div id="cart-sheet" class="sheet"></div>
  <div id="login-sheet" class="sheet"></div>

  <!-- =================================================
       SCRIPT
  ================================================== -->
  <script>
    /* ===============================
       GLOBAL STATE (SINGLE SOURCE)
    =============================== */
const state = {
   products: [],
   selectedProduct: null,
   cart: [],
   lastOrder: null,

   view: {
     screen: "list", // list | detail | cart | success | admin
     qty: 1
   },

   admin: {
     loggedIn: false,
     user: null,
     token: null
   },

   ui: {
     loading: false,
     overlayCount: 0,
     error: null
   }
 };
  </script>

  <script>
    /* ===============================
       API LAYER
    =============================== */
  </script>

  <script>
    /* ===============================
       UI HELPERS
    =============================== */
function renderHeader() {
   const header = document.getElementById("app-header");

   header.innerHTML = `
     <div class="title">Stock Viewer</div>
     <div class="actions">
       ${
         state.admin.loggedIn
           ? `<span>${state.admin.user}</span>`
           : `<button onclick="openLogin()">üîí ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô</button>`
       }
     </div>
   `;
 }

function openSheet(id) {
   document.getElementById(id)?.classList.add("show");
   state.ui.overlayCount++;
 }

 function closeSheet(id) {
   document.getElementById(id)?.classList.remove("show");
   state.ui.overlayCount = Math.max(0, state.ui.overlayCount - 1);
 }

  </script>

  <script>
    /* ===============================
       SCREEN RENDERERS
    =============================== */
function render() {
   switch (state.view.screen) {
     case "list":
       renderProductList();
       break;
     case "detail":
       renderProductDetail();
       break;
     case "cart":
       renderCart();
       break;
     case "success":
       renderSuccess();
       break;
     case "admin":
       renderAdminOrders();
       break;  
     default:
       console.warn("Unknown screen:", state.view.screen);
   }
 }

function renderProductList() {
  const app = document.getElementById("app");
   
  // loading state
  if (state.ui.loading) {
    app.innerHTML = "<p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‚Ä¶</p>";
    return;
  }

  // empty state
  if (!Array.isArray(state.products) || state.products.length === 0) {
    app.innerHTML = "<p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>";
    return;
  }

  app.innerHTML = `
    <section class="product-list">
      ${state.products.map(renderProductCard).join("")}
    </section>
    ${renderFloatingCart()}
  `;
 }

function renderFloatingCart() {
  if (!Array.isArray(state.cart) || state.cart.length === 0) {
    return "";
  }

  const totalQty = state.cart.reduce(
    (sum, item) => sum + item.qty,
    0
  );

  return `
    <div class="floating-cart" onclick="goToCart()">
      üõí <span class="count">${totalQty}</span>
    </div>
  `;
}
    
function renderProductCard(p) {
  const inCart = state.cart.find(i => i.productId === p.productId);

  return `
    <div class="card" onclick="openProduct('${p.productId}')">
      <div class="name">${p.name}</div>
      <div class="price">${p.price}</div>
      ${
        inCart
          ? `<div class="badge">${inCart.qty}</div>`
          : ""
      }
    </div>
  `;
}

 function renderProductDetail() {
  const app = document.getElementById("app");
  const p = state.selectedProduct;

  // guard: state ‡∏´‡∏•‡∏∏‡∏î
  if (!p) {
    state.view.screen = "list";
    render();
    return;
  }

  app.innerHTML = `
    <section class="product-detail">
      <button class="back" onclick="goToList()">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>

      <h2 class="name">${p.name}</h2>
      <div class="price">${p.price}</div>

      ${
        p.description
          ? `<div class="description">${p.description}</div>`
          : ""
      }

      <button class="btn-primary" onclick="openQtyPicker()">
        ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
      </button>
    </section>
  `;
}

 function renderCart() {
   const app = document.getElementById("app");
   
  // empty cart
  if (!Array.isArray(state.cart) || state.cart.length === 0) {
    app.innerHTML = `
      <section class="cart">
        <p>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á</p>
        <button onclick="goToList()">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
      </section>
    `;
    return;
  }

  const total = state.cart.reduce(
    (sum, item) => sum + item.price * item.qty,
    0
  );

  app.innerHTML = `
    <section class="cart">
      <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h2>

      <div class="cart-items">
        ${state.cart.map(renderCartItem).join("")}
      </div>

      <div class="cart-total">
        ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${total}
      </div>

      <button class="btn-primary" onclick="submitOrder()">
        ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
      </button>

      <button class="btn-secondary" onclick="goToList()">
        ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°
      </button>
    </section>
  `;
}

function renderCartItem(item) {
  return `
    <div class="cart-item">
      <div class="name">${item.name}</div>
      <div class="qty">x${item.qty}</div>
      <div class="price">${item.price * item.qty}</div>
    </div>
  `;
}   

function submitOrder() {
  submitOrderAPI();
}    

 function renderSuccess() {
   const app = document.getElementById("app");
   
   const order = state.lastOrder;

  // guard
  if (!order) {
    state.view.screen = "list";
    render();
    return;
  }

  app.innerHTML = `
    <section class="success">
      <h2>‚úÖ ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h2>

      <div class="order-summary">
        ${order.items.map(item => `
          <div class="order-item">
            <span>${item.name} x${item.qty}</span>
            <span>${item.price * item.qty}</span>
          </div>
        `).join("")}
      </div>

      <div class="order-total">
        ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${order.total}
      </div>

      <button class="btn-primary" onclick="goToList()">
        ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
      </button>

      <button class="btn-secondary" onclick="viewOrder()">
        ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
      </button>
    </section>
  `;
}

function viewOrder() {
  if (!state.admin.loggedIn) {
    openLogin();
    return;
  }
  state.view.screen = "admin";
  render();
}

function renderAdminOrders() {
  const app = document.getElementById("app");

  // guard: admin only
  if (!state.admin.loggedIn) {
    state.view.screen = "list";
    render();
    return;
  }

  if (!state.lastOrder) {
    app.innerHTML = "<p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</p>";
    return;
  }

  const order = state.lastOrder;

  app.innerHTML = `
    <section class="admin-orders">
      <h2>üì¶ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</h2>

      ${order.items.map(item => `
        <div class="order-item">
          <span>${item.name} x${item.qty}</span>
          <span>${item.price * item.qty}</span>
        </div>
      `).join("")}

      <div class="order-total">
        ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${order.total}
      </div>

      <button onclick="goToList()">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô</button>
    </section>
  `;
}    
    
  </script>

  <script>
    /* ===============================
       EVENT HANDLERS
    =============================== */
function goToList() {
   state.view.screen = "list";
   render();
 }

 function goToCart() {
   state.view.screen = "cart";
   render();
 }

function openProduct(productId) {
  state.selectedProduct =
    state.products.find(p => p.productId === productId) || null;

  if (!state.selectedProduct) return;

  state.view.screen = "detail";
  render();
}

function openLogin() {
   openSheet("login-sheet");
 }

function increaseQty() {
  state.view.qty++;
  renderQtyPicker();
}

function decreaseQty() {
  if (state.view.qty > 1) {
    state.view.qty--;
    renderQtyPicker();
  }
}

function confirmQty() {
  addToCart();
  closeSheet("qty-sheet");
  render(); // refresh badge / screen
}

function addToCart() {
  const p = state.selectedProduct;
  const qty = state.view.qty;

  if (!p || qty <= 0) return;

  const existing = state.cart.find(
    item => item.productId === p.productId
  );

  if (existing) {
    existing.qty += qty; // merge qty
  } else {
    state.cart.push({
      productId: p.productId,
      name: p.name,
      price: p.price,
      qty
    });
  }
}    

function openQtyPicker() {
  state.view.qty = 1;
  renderQtyPicker();
  openSheet("qty-sheet");
}

function renderQtyPicker() {
  const sheet = document.getElementById("qty-sheet");
  const p = state.selectedProduct;

  // guard: state ‡∏´‡∏•‡∏∏‡∏î
  if (!p) {
    closeSheet("qty-sheet");
    return;
  }

  sheet.innerHTML = `
    <div class="qty-picker">
      <h3>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</h3>

      <div class="qty-control">
        <button onclick="decreaseQty()">‚àí</button>
        <span class="qty">${state.view.qty}</span>
        <button onclick="increaseQty()">+</button>
      </div>

      <button class="btn-primary" onclick="confirmQty()">
        ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
      </button>

      <button class="btn-secondary" onclick="closeSheet('qty-sheet')">
        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
      </button>
    </div>
  `;
}

function submitOrderAPI() {
  // guard
  if (!Array.isArray(state.cart) || state.cart.length === 0) return;

  state.ui.loading = true;
  render();

  // mock API
  setTimeout(() => {
    // success
    state.lastOrder = {
      items: [...state.cart],
      total: state.cart.reduce(
        (sum, item) => sum + item.price * item.qty,
        0
      )
    };

    resetAfterOrder();
    state.view.screen = "success";
    state.ui.loading = false;
    render();
  }, 800);
}    

function resetAfterOrder() {
  state.cart = [];
  state.selectedProduct = null;
  state.view.qty = 1;
}
    
  </script>

  <script>
    /* ===============================
       APP BOOTSTRAP
    =============================== */
function boot() {
   renderHeader();
   render();
 }

 boot();
  </script>

</body>
</html>
